{{ define "student-exam-result" }}
<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Ujian | SayGenFix</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.395.0/dist/umd/lucide.min.js"></script>

    <link rel="stylesheet" href="/css/student_dashboard.css">

    <style>
        body {
            background-image: url('/path/ke/wpp.jpg');
            background-repeat: no-repeat;
            background-position: top left;
            background-size: contain;
        }

        .score-summary {
            background-color: var(--abu-muda);
            border-radius: 1rem;
            padding: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 2.5rem;
        }

        .score-circle-container {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            padding: 15px;
            background: conic-gradient(var(--biru-muda) var(--progress-value, 0deg),
                    var(--abu-gelap) 0deg);
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.5s ease-out;
        }

        .score-circle-inner {
            width: 100%;
            height: 100%;
            background-color: var(--abu-muda);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .score-text {
            text-align: center;
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .score-value span {
            font-size: 1.5rem;
            font-weight: 400;
            opacity: 0.8;
        }

        .score-status {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--biru-muda);
            margin-top: 0.5rem;
        }

        .result-card {
            background-color: var(--abu-muda);
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .result-card .card-header {
            font-weight: 600;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 1rem;
        }

        .result-card .card-body p {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .result-card .card-body p strong {
            display: block;
            margin-bottom: 0.25rem;
            opacity: 0.7;
        }

        .result-card .card-footer {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .page-actions {
            width: 100%;
            margin-top: 2.5rem;
            display: flex;
            justify-content: flex-end;
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        .status-badge.bagus {
            background-color: rgba(0, 255, 144, 0.1);
            color: #00FF90;
        }

        .status-badge.cukup {
            background-color: rgba(255, 199, 0, 0.1);
            color: #FFC700;
        }

        .status-badge.salah {
            background-color: rgba(255, 71, 87, 0.1);
            color: #FF4757;
        }
    </style>
</head>

<body>
    {{ template "student-exam-result-navbar" . }}

    <main class="main-content">
        <div class="page-header">
            <h1>Nilai Hasil</h1>
        </div>

        <section class="score-summary">
            <div class="score-circle-container" id="score-circle">
                <div class="score-circle-inner">
                    <div class="score-text">
                        <div class="score-value">
                            <span id="score-number">{{.TotalScore}}</span><span>/100</span>
                        </div>
                        <p class="score-status" id="score-status-text">
                            {{ if ge .TotalScore 80 }}Sangat Baik!
                            {{ else if ge .TotalScore 60 }}Cukup Baik
                            {{ else }}Perlu Ditingkatkan
                            {{ end }}
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section class="exam-grid" id="results-container">
            <!-- Render kartu hasil dari data backend -->
            {{ range $index, $correction := .Corrections }}
            <article class="result-card">
                <div class="card-header">Pertanyaan {{ add $index 1 }}</div>
                <div class="card-body">
                    <p><strong>Soal :</strong>{{ $correction.Question }}</p>
                    <p><strong>Jawaban Anda :</strong>{{ $correction.StudentAnswer }}</p>
                </div>
                <div class="card-footer">
                    {{ $statusClass := "salah" }}
                    {{ if eq $correction.Feedback "Bagus" }}{{ $statusClass = "bagus" }}{{ end }}
                    {{ if eq $correction.Feedback "Cukup" }}{{ $statusClass = "cukup" }}{{ end }}
                    <span class="status-badge {{ $statusClass }}">{{ $correction.Feedback }}</span>
                    <span class="score">{{ $correction.Score }}/{{ $.MaxScorePerQuestion }}</span>
                </div>
            </article>
            {{ end }}
        </section>

        <div class="page-actions">
            <a href="/" class="action-button">Selesai</a>
        </div>
    </main>

    <script>
        lucide.createIcons();

        document.addEventListener('DOMContentLoaded', function () {
            const scoreNumberEl = document.getElementById('score-number');
            const scoreCircleEl = document.getElementById('score-circle');

            // Ambil skor akhir langsung dari elemen yang dirender oleh server
            const finalScore = parseInt(scoreNumberEl.textContent, 10) || 0;

            // Animasikan lingkaran skor
            let currentScore = 0;
            const animationInterval = setInterval(() => {
                currentScore++;
                const progressDegrees = (currentScore / 100) * 360;
                scoreCircleEl.style.setProperty('--progress-value', `${progressDegrees}deg`);
                if (currentScore >= finalScore) {
                    clearInterval(animationInterval);
                }
            }, 20);
        });
    </script>
</body>

</html>
{{ end }}